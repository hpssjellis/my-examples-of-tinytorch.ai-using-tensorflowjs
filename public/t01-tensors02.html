<!DOCTYPE html>
<html>
<head>
    <title>TensorFlow.js Tensor Fundamentals (TinyTorch 01)</title>
    <style>
        /* Minimal CSS for readability and centering */
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        h2, h3, h4 {
            color: #333;
        }
        table {
            border-collapse: collapse;
            margin: 5px 0;
        }
        td {
            padding: 4px 8px;
            text-align: center;
        }
    </style>
</head>
<body>

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.0.0"></script>
<h2 align=center>Basic Demonstration of TensorFlow.js Tensors</h2>

<br>See the video <a href="https://www.youtube.com/watch?v=ACQy0FhL5RY&list=PL57Dnr1H_egukaDgFqwEnDVStd7Jktg1E&index=2"> here. </a><br>
<iframe width="250" height="140" src="https://www.youtube.com/embed/ACQy0FhL5RY" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe><br><br><br>

<div style="font-size:15px; background-color:lightyellow; width:88%;  border:5px solid blue; padding:5px; margin:5px;"> 
    This page introduces core **Tensor operations** that form the foundation of machine learning frameworks (like TinyTorch): 
    <ol>  
        <li>Making and viewing **Tensors** (multi-dimensional arrays).
        <li>**Element-Wise** Operations (Addition, Multiplication).
        <li>**Reshaping** (Flatten, Transpose).
        <li>**Reduction** Operations (Sum, Mean).
        <li>**Matrix Multiplication** (`matMul`).
        <li>How to manage **Tensor Memory** with `tf.tidy()` and `.dispose()`.
    </ol>
</div><br>

    <div id="myDiv321Code"> 
<script>
         ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
           // Helper function just formats Matrices nicely on a webpage
// myDiv as a string, myOutTensor as a tensor, myCols as an integer, myTitle as a string
async function myTensorTable(myDiv, myOutTensor, myCols, myTitle){
      document.getElementById(myDiv).innerHTML += myTitle + '<br>'
      const myOutput = await myOutTensor.data()
      // Use .shape to get dimensions for better generalization
      const myShape = myOutTensor.shape.join('x')
      
      let myTemp = `**Shape: [${myShape}]**<br><table border=3><tr>`

      // If the tensor is 1D, myCols should probably be its size, but we keep it flexible
      const myEffectiveCols = (myOutTensor.rank > 1) ? myCols : myOutTensor.size; 
      
      for (let myCount = 0; myCount < myOutTensor.size; myCount++){
        myTemp += '<td>'+ myOutput[myCount] + '</td>'
        if (myCount % myEffectiveCols == myEffectiveCols - 1 && myCount < myOutTensor.size - 1){
            myTemp += '</tr><tr>'
        }
      }
      myTemp += '</tr></table>'
      document.getElementById(myDiv).innerHTML += myTemp + '<br>'
}
     ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                  
async function myTest321(){
   document.getElementById('myDiv321').innerHTML ='<h3>Tensor Fundamentals</h3>'

   // 1. TENSOR CREATION AND PROPERTIES
   document.getElementById('myDiv321').innerHTML += '<h4>1. Creation and Properties</h4>'
   const myInputs = tf.tensor2d([10, 20, 30, 40, 50, 60], [2, 3]); // 2 rows, 3 columns (Tensor A)
   const myWeights = tf.tensor2d([1, 2, 3, 4, 5, 6], [3, 2]);      // 3 rows, 2 columns (Tensor W)
   const myScalarBias = tf.scalar(5.0);
   
   await myTensorTable('myDiv321', myInputs, 3, 'Input Tensor (A)')
   await myTensorTable('myDiv321', myWeights, 2, 'Weight Tensor (W)')
   document.getElementById('myDiv321').innerHTML += 'Scalar Bias = ' + await myScalarBias.data() + '<br><hr>'

   // 2. ELEMENT-WISE OPERATIONS
   document.getElementById('myDiv321').innerHTML += '<h4>2. Element-Wise Operations (A + 1, A * 2)</h4>'
   const myAddScalar = myInputs.add(1); // Add a scalar (Broadcasting)
   const myMultiply = myInputs.mul(tf.scalar(2)); // Multiply by a scalar
   
   await myTensorTable('myDiv321', myAddScalar, 3, 'A.add(1)')
   await myTensorTable('myDiv321', myMultiply, 3, 'A.mul(2)')
   myAddScalar.dispose(); myMultiply.dispose();
   document.getElementById('myDiv321').innerHTML += '<hr>'

   // 3. RESHAPING AND MANIPULATION
   document.getElementById('myDiv321').innerHTML += '<h4>3. Reshaping and Manipulation</h4>'
   const myFlattened = myInputs.flatten(); // Change shape to 1D
   const myTransposed = myInputs.transpose(); // Swap dimensions (2x3 -> 3x2)
   
   await myTensorTable('myDiv321', myFlattened, 1, 'A.flatten()')
   await myTensorTable('myDiv321', myTransposed, 2, 'A.transpose()')
   myFlattened.dispose(); myTransposed.dispose();
   document.getElementById('myDiv321').innerHTML += '<hr>'

   // 4. REDUCTION OPERATIONS
   document.getElementById('myDiv321').innerHTML += '<h4>4. Reduction Operations (Sum, Mean)</h4>'
   const mySumAll = myInputs.sum();
   const myMeanAll = myInputs.mean();
   
   document.getElementById('myDiv321').innerHTML += 'A.sum() = ' + await mySumAll.data() + '<br>'
   document.getElementById('myDiv321').innerHTML += 'A.mean() = ' + await myMeanAll.data() + '<br><hr>'
   mySumAll.dispose(); myMeanAll.dispose();


   // 5. MATRIX MULTIPLICATION (The core Linear Layer operation)
   document.getElementById('myDiv321').innerHTML += '<h4>5. Matrix Multiplication (A x W)</h4>'
   // Matrix multiplication: (2x3) x (3x2) = (2x2)
   // This is the fundamental operation for the "Linear" layer
   const myProduct = tf.matMul(myInputs, myWeights);
   await myTensorTable('myDiv321', myProduct, 2, 'tf.matMul(A, W)')
   myProduct.dispose();
   document.getElementById('myDiv321').innerHTML += '<hr>'

   // 6. MEMORY MANAGEMENT (tf.tidy)
   document.getElementById('myDiv321').innerHTML += '<h4>6. Memory Management with tf.tidy</h4>'
   // tf.tidy cleans up all intermediate tensors automatically
   const myTidyResult = tf.tidy(() => {
        // Only myOutputTensor is *not* disposed when tidy ends
        const myInterimProduct = tf.matMul(myInputs, myWeights);
        const myOutputTensor = myInterimProduct.add(myScalarBias); // Broadcasting scalar bias to 2x2 matrix
        return myOutputTensor;
   });

   await myTensorTable('myDiv321', myTidyResult, 2, 'tf.tidy Result: (A x W) + Bias')
   
   // Clean up all tensors we created outside of tf.tidy
   myInputs.dispose(); myWeights.dispose(); myScalarBias.dispose(); myTidyResult.dispose();

   document.getElementById('myDiv321').innerHTML += 'All Tensors Disposed. Check memory usage if needed.'

}
</script>


<input type="button" id="myButton321" value="Run All" onclick="{    myTest321();}"><br><br><br>
</div><div id='myDiv321'>...</div><br>
<input id="myUpdate321"  type=button value="Update and Run" style="visibility:hidden;" onclick="{
   // first remove first and last line since they are injected  
   myFred = document.getElementById('myTextarea321').value.split('\n')  
   myFred.pop()  
   myFred.push('')  
   myFred.shift()  
   myFred.shift()  
   myJoe = myFred.join('\n')
  document.getElementById('myDiv321Code').innerHTML =    myJoe   
  document.getElementById('myButton321').click()                                             
}"><br>
<textarea id="myTextarea321"   wrap="off"  style= "font-size:15px; color:white; background-color:black; width:90%;"   rows=2 onclick="{  if (myOnce321){     myTextGrow('myTextarea321', 'myDiv321Code')     document.getElementById('myUpdate321').style.visibility = 'visible'     myOnce321 = false  }}">Click here to see the working HTML code.</textarea><br>



<br><br><br><hr><br><br><br><br>


This <a href="https://github.com/hpssjellis/beginner-tensorflowjs-examples-in-javascript">Github</a>, ...  this <a href="https://hpssjellis.github.io/beginner-tensorflowjs-examples-in-javascript/">Github Website Version</a>, ... this <a href="http://rocksetta.com/tensorflowjs/">Hosted Website Version</a>, ... <a href="https://js.tensorflow.org/">Tensorflowjs</a> <br> <br>


By Jeremy Ellis <br>Twitter<a href="https://twitter.com/@rocksetta">@rocksetta</a><br>Website <a href="http://rocksetta.com">http://rocksetta.com</a><br>Use at your own risk!            

   
<script>
myOnce321 = true    // so textareas are only clicked once

function myTextGrow(myT, myB){   
    let myCursorStart = document.getElementById(myT).selectionStart   
    let myCursorEnd = document.getElementById(myT).selectionEnd
    let myDivName = myB.replace('Code','')   
    // Note: \x3C is used for '<' to avoid issues with inline scripts
    document.getElementById(myT).value = '\x3Cscript src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.0.0"> \x3C/script> \n\n' + document.getElementById(myB).innerHTML    
    document.getElementById(myT).value += '<div id=\''+myDivName+'\'>...</div><br>'        
    
    // Grow the textarea height to fit all the code
    setTimeout(function() {      
        while (  document.getElementById(myT).clientHeight < document.getElementById(myT).scrollHeight){                                                                                                                                                        
            document.getElementById(myT).rows += 3;       
        }    
    }, 100)
    document.getElementById(myT).selectionStart = myCursorStart  
    document.getElementById(myT).selectionEnd = myCursorEnd
}
</script> 

</body>
</html>
